<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Web GIS - Ramallah</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    #map {
      height: 100%;
      width: 100%;
    }
  </style>
</head>

<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* =========================
   1. إنشاء الخريطة
========================= */
var map = L.map("map").setView([31.9038, 35.2034], 11);

/* =========================
   2. خريطة الأساس
========================= */
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "&copy; OpenStreetMap contributors"
}).addTo(map);

/* =========================
   3. دالة إنشاء Popup من الـ Attributes
========================= */
function popupAttributes(feature, layer) {
  if (feature.properties) {
    let content = "";
    for (let key in feature.properties) {
      content += "<b>" + key + "</b>: " + feature.properties[key] + "<br>";
    }
    layer.bindPopup(content);
  }
}

/* =========================
   4. إعداد الأيقونات
========================= */
var schoolIcon = L.icon({
  iconUrl: 'icons/school.png',
  iconSize: [25,25],
  iconAnchor: [12,12],
  popupAnchor: [0,-12]
});

var wellIcon = L.icon({
  iconUrl: 'icons/well.png',
  iconSize: [20,20],
  iconAnchor: [10,10],
  popupAnchor: [0,-10]
});

var quarryIcon = L.icon({
  iconUrl: 'icons/pickaxe.png', // بيكاكس
  iconSize: [25,25],
  iconAnchor: [12,12],
  popupAnchor: [0,-12]
});

var outpostIcon = L.icon({
  iconUrl: 'icons/red_tent.png', // خيمة حمراء
  iconSize: [25,25],
  iconAnchor: [12,12],
  popupAnchor: [0,-12]
});

// أيقونة المستشفيات على شكل H زرقاء
var hospitalIcon = L.icon({
  iconUrl: 'icons/hospital_h.png', // ضع هنا صورة H زرقاء
  iconSize: [25,25],
  iconAnchor: [12,12],
  popupAnchor: [0,-12]
});

var clinicIcon = L.icon({
  iconUrl: 'icons/clinic.png',
  iconSize: [25,25],
  iconAnchor: [12,12],
  popupAnchor: [0,-12]
});

/* =========================
   5. تحميل الطبقات
========================= */
Promise.all([
  fetch("ramallah.json").then(r => r.json()),
  fetch("schools.json").then(r => r.json()),
  fetch("roods.json").then(r => r.json()),
  fetch("Built_up.json").then(r => r.json()),
  fetch("Settlements.geojson").then(r => r.json()),
  fetch("Outposts.geojson").then(r => r.json()),
  fetch("Military sites.geojson").then(r => r.json()),
  fetch("Quarries.geojson").then(r => r.json()),
  fetch("natural.json").then(r => r.json()),
  fetch("Wells.geojson").then(r => r.json()),
  fetch("Clinics.geojson").then(r => r.json()),
  fetch("Hospitals.geojson").then(r => r.json())
]).then(initLayers);

/* =========================
   6. عرض الطبقات
========================= */
function initLayers(data) {

  let [
    ramallah,
    schools,
    roads,
    built,
    settlements,
    outposts,
    military,
    quarries,
    natural,
    wells,
    clinics,
    hospitals
  ] = data;

  /* رام الله - بوردر فقط */
  var ramallahLayer = L.geoJSON(ramallah, {
    style: {
      color: "#000000",
      weight: 3,
      fillOpacity: 0
    },
    onEachFeature: popupAttributes
  }).addTo(map);

  /* المدارس مع أيقونة */
  var schoolsLayer = L.geoJSON(schools, {
    pointToLayer: function(feature, latlng) {
      return L.marker(latlng, { icon: schoolIcon });
    },
    onEachFeature: popupAttributes
  }).addTo(map);

  /* الطرق باللون السكني الغامق */
  var roadsLayer = L.geoJSON(roads, {
    style: { color: "#4B0082", weight: 2 },
    onEachFeature: popupAttributes
  }).addTo(map);

  /* Built-up Areas مع إبراز الحدود لكل تجمع */
  var builtLayer = L.geoJSON(built, {
    style: function(feature) {
      return {
        color: "#8B4513",      // الحدود داكنة وواضحة
        fillColor: "#F5F5DC",
        weight: 3,
        fillOpacity: 0.7
      };
    },
    onEachFeature: popupAttributes
  }).addTo(map);

  /* طبقات النقاط مع أيقونات */
  var settlementsLayer = L.geoJSON(settlements, {
    style: { color: "#FF0000", weight: 2 },
    onEachFeature: popupAttributes
  }).addTo(map);

  var outpostsLayer = L.geoJSON(outposts, {
    pointToLayer: function(feature, latlng) {
      return L.marker(latlng, { icon: outpostIcon });
    },
    onEachFeature: popupAttributes
  }).addTo(map);

  var militaryLayer = L.geoJSON(military, {
    style: { color: "#800000", weight: 2 },
    onEachFeature: popupAttributes
  }).addTo(map);

  var quarriesLayer = L.geoJSON(quarries, {
    pointToLayer: function(feature, latlng) {
      return L.marker(latlng, { icon: quarryIcon });
    },
    onEachFeature: popupAttributes
  }).addTo(map);

  var naturalLayer = L.geoJSON(natural, {
    style: { color: "#228B22", fillOpacity: 0.5 },
    onEachFeature: popupAttributes
  }).addTo(map);

  var wellsLayer = L.geoJSON(wells, {
    pointToLayer: function(feature, latlng) {
      return L.marker(latlng, { icon: wellIcon });
    },
    onEachFeature: popupAttributes
  }).addTo(map);

  var clinicsLayer = L.geoJSON(clinics, {
    pointToLayer: function(feature, latlng) {
      return L.marker(latlng, { icon: clinicIcon });
    },
    onEachFeature: popupAttributes
  }).addTo(map);

  var hospitalsLayer = L.geoJSON(hospitals, {
    pointToLayer: function(feature, latlng) {
      return L.marker(latlng, { icon: hospitalIcon });
    },
    onEachFeature: popupAttributes
  }).addTo(map);

  /* =========================
     7. Layer Control
  ========================= */
  L.control.layers(null, {
    "Ramallah Boundary": ramallahLayer,
    "Schools": schoolsLayer,
    "Roads": roadsLayer,
    "Built-up Areas": builtLayer,
    "Settlements": settlementsLayer,
    "Outposts": outpostsLayer,
    "Military Sites": militaryLayer,
    "Quarries": quarriesLayer,
    "Natural Areas": naturalLayer,
    "Wells": wellsLayer,
    "Clinics": clinicsLayer,
    "Hospitals": hospitalsLayer
  }, { collapsed: false }).addTo(map);
}
</script>

</body>
</html>
