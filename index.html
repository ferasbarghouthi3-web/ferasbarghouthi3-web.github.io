<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Web GIS - Ramallah</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    #map {
      height: 100%;
      width: 100%;
    }
  </style>
</head>

<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* =========================
   1. إنشاء الخريطة
========================= */
var map = L.map("map").setView([31.9038, 35.2034], 11);

/* =========================
   2. خريطة الأساس
========================= */
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "&copy; OpenStreetMap contributors"
}).addTo(map);

/* =========================
   3. دالة إنشاء Popup من الـ Attributes
========================= */
function popupAttributes(feature, layer) {
  if (feature.properties) {
    let content = "";
    for (let key in feature.properties) {
      content += "<b>" + key + "</b>: " + feature.properties[key] + "<br>";
    }
    layer.bindPopup(content);
  }
}

/* =========================
   4. تحميل الطبقات
========================= */
Promise.all([
  fetch("ramallah.json").then(r => r.json()),
  fetch("schools.json").then(r => r.json()),
  fetch("roods.json").then(r => r.json()),
  fetch("Built_up.json").then(r => r.json()),
  fetch("Settlements.geojson").then(r => r.json()),
  fetch("Outposts.geojson").then(r => r.json()),
  fetch("Military sites.geojson").then(r => r.json()),
  fetch("Quarries.geojson").then(r => r.json()),
  fetch("natural.json").then(r => r.json()),
  fetch("Wells.geojson").then(r => r.json()),
  fetch("Clinics.geojson").then(r => r.json()),
  fetch("Hospitals.geojson").then(r => r.json())
]).then(initLayers);

/* =========================
   5. عرض الطبقات
========================= */
function initLayers(data) {

  let [
    ramallah,
    schools,
    roads,
    built,
    settlements,
    outposts,
    military,
    quarries,
    natural,
    wells,
    clinics,
    hospitals
  ] = data;

  /* رام الله - بوردر فقط */
  var ramallahLayer = L.geoJSON(ramallah, {
    style: {
      color: "#000000",
      weight: 3,
      fillOpacity: 0
    },
    onEachFeature: popupAttributes
  }).addTo(map);

  var schoolsLayer = L.geoJSON(schools, {
    onEachFeature: popupAttributes
  }).addTo(map);

  var roadsLayer = L.geoJSON(roads, {
    style: { color: "#8B4513", weight: 2 },
    onEachFeature: popupAttributes
  }).addTo(map);

  /* Built-up لون بيج فاتح */
  var builtLayer = L.geoJSON(built, {
    style: {
      color: "#D2B48C",
      fillColor: "#F5F5DC",
      weight: 1,
      fillOpacity: 0.7
    },
    onEachFeature: popupAttributes
  }).addTo(map);

  var settlementsLayer = L.geoJSON(settlements, {
    style: { color: "#FF0000", weight: 2 },
    onEachFeature: popupAttributes
  }).addTo(map);

  var outpostsLayer = L.geoJSON(outposts, {
    style: { color: "#FF8C00", weight: 2 },
    onEachFeature: popupAttributes
  }).addTo(map);

  var militaryLayer = L.geoJSON(military, {
    style: { color: "#800000", weight: 2 },
    onEachFeature: popupAttributes
  }).addTo(map);

  var quarriesLayer = L.geoJSON(quarries, {
    style: { color: "#708090", weight: 2 },
    onEachFeature: popupAttributes
  }).addTo(map);

  var naturalLayer = L.geoJSON(natural, {
    style: { color: "#228B22", fillOpacity: 0.5 },
    onEachFeature: popupAttributes
  }).addTo(map);

  var wellsLayer = L.geoJSON(wells, {
    onEachFeature: popupAttributes
  }).addTo(map);

  var clinicsLayer = L.geoJSON(clinics, {
    onEachFeature: popupAttributes
  }).addTo(map);

  var hospitalsLayer = L.geoJSON(hospitals, {
    onEachFeature: popupAttributes
  }).addTo(map);

  /* =========================
     6. Layer Control
  ========================= */
  L.control.layers(null, {
    "Ramallah Boundary": ramallahLayer,
    "Schools": schoolsLayer,
    "Roads": roadsLayer,
    "Built-up Areas": builtLayer,
    "Settlements": settlementsLayer,
    "Outposts": outpostsLayer,
    "Military Sites": militaryLayer,
    "Quarries": quarriesLayer,
    "Natural Areas": naturalLayer,
    "Wells": wellsLayer,
    "Clinics": clinicsLayer,
    "Hospitals": hospitalsLayer
  }, { collapsed: false }).addTo(map);
}
</script>

</body>
</html>
