<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Web GIS - Ramallah</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    #map {
      height: 100%;
      width: 100%;
    }
  </style>
</head>

<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* =========================
   1. إنشاء الخريطة
========================= */
var map = L.map("map").setView([31.9038, 35.2034], 11);

/* =========================
   2. خريطة الأساس
========================= */
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "&copy; OpenStreetMap contributors"
}).addTo(map);

/* =========================
   3. Popup من الـ Attributes
========================= */
function popupAttributes(feature, layer) {
  if (feature.properties) {
    let content = "";
    for (let key in feature.properties) {
      content += "<b>" + key + "</b>: " + feature.properties[key] + "<br>";
    }
    layer.bindPopup(content);
  }
}

/* =========================
   4. الأيقونات
========================= */
var schoolIcon = L.icon({
  iconUrl: "./icons/school.png",
  iconSize: [28,28],
  iconAnchor: [14,14],
  popupAnchor: [0,-14]
});

var wellIcon = L.icon({
  iconUrl: "./icons/well.png",
  iconSize: [22,22],
  iconAnchor: [11,11],
  popupAnchor: [0,-11]
});

var quarryIcon = L.icon({
  iconUrl: "./icons/pickaxe.png",
  iconSize: [26,26],
  iconAnchor: [13,13],
  popupAnchor: [0,-13]
});

var outpostIcon = L.icon({
  iconUrl: "./icons/red_tent.png",
  iconSize: [26,26],
  iconAnchor: [13,13],
  popupAnchor: [0,-13]
});

var hospitalIcon = L.icon({
  iconUrl: "./icons/hospital_h.png",
  iconSize: [30,30],
  iconAnchor: [15,15],
  popupAnchor: [0,-15]
});

var clinicIcon = L.icon({
  iconUrl: "./icons/clinic.png",
  iconSize: [26,26],
  iconAnchor: [13,13],
  popupAnchor: [0,-13]
});

/* =========================
   5. تحميل البيانات
========================= */
Promise.all([
  fetch("data/ramallah.geojson").then(r => r.json()),
  fetch("data/schools.geojson").then(r => r.json()),
  fetch("data/roads.geojson").then(r => r.json()),
  fetch("data/built_up.geojson").then(r => r.json()),
  fetch("data/settlements.geojson").then(r => r.json()),
  fetch("data/outposts.geojson").then(r => r.json()),
  fetch("data/military_sites.geojson").then(r => r.json()),
  fetch("data/quarries.geojson").then(r => r.json()),
  fetch("data/natural.geojson").then(r => r.json()),
  fetch("data/wells.geojson").then(r => r.json()),
  fetch("data/clinics.geojson").then(r => r.json()),
  fetch("data/hospitals.geojson").then(r => r.json())
]).then(initLayers);

/* =========================
   6. عرض الطبقات
========================= */
function initLayers(data) {

  let [
    ramallah,
    schools,
    roads,
    built,
    settlements,
    outposts,
    military,
    quarries,
    natural,
    wells,
    clinics,
    hospitals
  ] = data;

  /* حدود رام الله */
  var ramallahLayer = L.geoJSON(ramallah, {
    style: {
      color: "#000000",
      weight: 6,
      fillOpacity: 0
    },
    onEachFeature: popupAttributes
  }).addTo(map);

  /* المدارس */
  var schoolsLayer = L.geoJSON(schools, {
    pointToLayer: (f, latlng) => L.marker(latlng, { icon: schoolIcon }),
    onEachFeature: popupAttributes
  }).addTo(map);

  /* الطرق */
  var roadsLayer = L.geoJSON(roads, {
    style: { color: "#4B0082", weight: 2 },
    onEachFeature: popupAttributes
  }).addTo(map);

  /* المناطق المبنية */
  var builtLayer = L.geoJSON(built, {
    style: {
      color: "#8B4513",
      weight: 2,
      fillColor: "#F5F5DC",
      fillOpacity: 0.6
    },
    onEachFeature: popupAttributes
  }).addTo(map);

  /* المستوطنات */
  var settlementsLayer = L.geoJSON(settlements, {
    style: { color: "#FF0000", weight: 2 },
    onEachFeature: popupAttributes
  }).addTo(map);

  /* البؤر */
  var outpostsLayer = L.geoJSON(outposts, {
    pointToLayer: (f, latlng) => L.marker(latlng, { icon: outpostIcon }),
    onEachFeature: popupAttributes
  }).addTo(map);

  /* المواقع العسكرية */
  var militaryLayer = L.geoJSON(military, {
    style: { color: "#800000", weight: 2 },
    onEachFeature: popupAttributes
  }).addTo(map);

  /* الكسارات */
  var quarriesLayer = L.geoJSON(quarries, {
    pointToLayer: (f, latlng) => L.marker(latlng, { icon: quarryIcon }),
    onEachFeature: popupAttributes
  }).addTo(map);

  /* المناطق الطبيعية */
  var naturalLayer = L.geoJSON(natural, {
    style: { color: "#228B22", fillOpacity: 0.5 },
    onEachFeature: popupAttributes
  }).addTo(map);

  /* الآبار */
  var wellsLayer = L.geoJSON(wells, {
    pointToLayer: (f, latlng) => L.marker(latlng, { icon: wellIcon }),
    onEachFeature: popupAttributes
  }).addTo(map);

  /* العيادات */
  var clinicsLayer = L.geoJSON(clinics, {
    pointToLayer: (f, latlng) => L.marker(latlng, { icon: clinicIcon }),
    onEachFeature: popupAttributes
  }).addTo(map);

  /* المستشفيات */
  var hospitalsLayer = L.geoJSON(hospitals, {
    pointToLayer: (f, latlng) => L.marker(latlng, { icon: hospitalIcon }),
    onEachFeature: popupAttributes
  }).addTo(map);

  ramallahLayer.bringToFront();

  /* التحكم بالطبقات */
  L.control.layers(null, {
    "Ramallah Boundary": ramallahLayer,
    "Built-up Areas": builtLayer,
    "Roads": roadsLayer,
    "Schools": schoolsLayer,
    "Settlements": settlementsLayer,
    "Outposts": outpostsLayer,
    "Military Sites": militaryLayer,
    "Quarries": quarriesLayer,
    "Natural Areas": naturalLayer,
    "Wells": wellsLayer,
    "Clinics": clinicsLayer,
    "Hospitals": hospitalsLayer
  }, { collapsed: false }).addTo(map);
}
</script>

</body>
</html>
