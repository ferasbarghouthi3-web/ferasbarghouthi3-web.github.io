<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Ramallah Waste Containers - Enhanced Map</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      height: 100%;
      width: 100%;
    }
    #map {
      position: absolute;
      width: 100%;
      height: 100%;
    }
    .info {
      background: rgba(255, 255, 255, 0.8);
      padding: 6px 8px;
      font: 14px/16px Arial, Helvetica, sans-serif;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Libraries -->
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

  <script>
    // إعداد الخريطة
    const map = L.map("map", {
      center: [31.9045, 35.2045],
      zoom: 15
    });

    // طبقات الخلفية
    const baseLayers = {
      "خريطة داكنة": L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OpenStreetMap & CARTO'
      }),
      "خريطة الشوارع": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap'
      }),
      "أقمار صناعية": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: '&copy; Esri & OpenStreetMap contributors'
      })
    };

    baseLayers["خريطة داكنة"].addTo(map); // الافتراضية

    let wasteContainersLayer, zonesLayer;

    // تحميل بيانات الحاويات
    $.getJSON("wasteContainer.json", function(WC) {
      wasteContainersLayer = L.geoJson(WC, {
        pointToLayer: function(feature, latlng) {
          const color =
            feature.properties.TYPE_OF_WA === "Iron" ? "red" :
            feature.properties.TYPE_OF_WA === "Plastic" ? "blue" :
            "green";
          return L.circleMarker(latlng, {
            radius: 6,
            fillColor: color,
            color: "white",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
          });
        },
        onEachFeature: function(feature, layer) {
          layer.bindPopup(`
            <b>نوع الحاوية:</b> ${feature.properties.TYPE_OF_WA || "iron"}<br>
            <b>الرمز:</b> ${feature.properties.ID || "iron"}
          `);
        }
      });
      wasteContainersLayer.addTo(map);
    });

    // تحميل بيانات المناطق
    $.getJSON("RamallahZones.json", function(RZ) {
      zonesLayer = L.geoJson(RZ, {
        style: {
          fillColor: "gray",
          fillOpacity: 0.2,
          color: "black",
          weight: 1
        },
        onEachFeature: function(feature, layer) {
          layer.on('click', function(e) {
            // حساب عدد الحاويات داخل المنطقة
            if (!wasteContainersLayer) return;
            const zone = feature;
            let count = 0;
            wasteContainersLayer.eachLayer(function(container) {
              const point = turf.point([container.getLatLng().lng, container.getLatLng().lat]);
              if (turf.booleanPointInPolygon(point, zone)) count++;
            });
            layer.bindPopup(`<b>المنطقة:</b> ${feature.properties.NAME}<br>
                             <b>عدد الحاويات:</b> ${count}`).openPopup();
          });
        }
      });
      zonesLayer.addTo(map);
    });

    // التحكم بالطبقات
    const overlays = {
      "مناطق رام الله": zonesLayer,
      "حاويات النفايات": wasteContainersLayer
    };

    L.control.layers(baseLayers, overlays, { collapsed: false }).addTo(map);

    // عرض الإحداثيات في الأسفل
    const info = L.control({ position: 'bottomleft' });
    info.onAdd = function(map) {
      this._div = L.DomUtil.create('div', 'info');
      this.update();
      return this._div;
    };
    info.update = function(latlng) {
      this._div.innerHTML = latlng
        ? `<b>Lat:</b> ${latlng.lat.toFixed(5)} , <b>Lng:</b> ${latlng.lng.toFixed(5)}`
        : "حرّك الماوس على الخريطة";
    };
    info.addTo(map);
    map.on('mousemove', function(e) {
      info.update(e.latlng);
    });
  </script>
</body>
</html>










