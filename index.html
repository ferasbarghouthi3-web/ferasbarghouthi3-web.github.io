<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Web GIS - Ramallah</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html,body{height:100%;margin:0;}
#map{height:100%;width:100%;}

/* ICONS */
.icon{
  width:20px;height:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
  font-weight:bold;
  border:2px solid #000;
}
.icon-school{background:#1e90ff;color:#fff;border-radius:4px;}
.icon-hospital{background:#b22222;color:#fff;border-radius:50%;}
.icon-clinic{background:#2e8b57;color:#fff;}
.icon-well{background:#00ced1;color:#000;border-radius:50%;}
.icon-quarry{background:#696969;color:#fff;}
.icon-outpost{background:#ff8c00;color:#000;clip-path:polygon(50% 0%,0% 100%,100% 100%);}
.icon-suggested{background:#006400;color:#fff;border-radius:50%;}

/* LEGEND */
.legend{
  background:white;
  padding:10px;
  font-size:13px;
  border-radius:6px;
  box-shadow:0 0 10px rgba(0,0,0,0.3);
}
.legend-item{
  display:flex;
  align-items:center;
  gap:6px;
  margin-bottom:4px;
}

/* POPUP */
.popup-table{border-collapse:collapse;width:100%;}
.popup-table td{border-bottom:1px solid #ddd;padding:4px;font-size:12px;}
.popup-title{font-weight:bold;margin-bottom:6px;}
</style>
</head>

<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>

/* MAP */
var map = L.map("map").setView([31.9038,35.2034],11);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{
  attribution:"&copy; OpenStreetMap"
}).addTo(map);

/* POPUP */
function popupAttributes(feature, layer){
  if(!feature.properties) return;
  let html='<div class="popup-title">Attributes</div><table class="popup-table">';
  for(let k in feature.properties){
    html+=`<tr><td><b>${k}</b></td><td>${feature.properties[k]}</td></tr>`;
  }
  html+='</table>';
  layer.bindPopup(html);
}

/* ICON */
function icon(symbol, cls){
  return L.divIcon({
    className:"",
    html:`<div class="icon ${cls}">${symbol}</div>`,
    iconSize:[20,20],
    iconAnchor:[10,10]
  });
}

/* LOAD DATA */
Promise.all([
  fetch("ramallah.json").then(r=>r.json()),
  fetch("schools.json").then(r=>r.json()),
  fetch("roods.json").then(r=>r.json()),
  fetch("Built_up.json").then(r=>r.json()),
  fetch("Settlements.geojson").then(r=>r.json()),
  fetch("Outposts.geojson").then(r=>r.json()),
  fetch("Military sites.geojson").then(r=>r.json()),
  fetch("Quarries.geojson").then(r=>r.json()),
  fetch("natural.json").then(r=>r.json()),
  fetch("Wells.geojson").then(r=>r.json()),
  fetch("Clinics.geojson").then(r=>r.json()),
  fetch("Hospitals.geojson").then(r=>r.json()),
  fetch("area_A.geojson").then(r=>r.json()),
  fetch("Area_B.geojson").then(r=>r.json()),
  fetch("area_C.geojson").then(r=>r.json())
]).then(initLayers);

/* LAYERS */
function initLayers(data){

let [
  ramallah,schools,roads,built,
  settlements,outposts,military,
  quarries,natural,wells,clinics,hospitals,
  areaA,areaB,areaC
] = data;

/* RAMALLAH BORDER */
var ramallahLayer=L.geoJSON(ramallah,{
  style:{color:"#000",weight:4,fillOpacity:0},
  onEachFeature:popupAttributes
}).addTo(map);

/* LAND CLASSIFICATION */
var areaALayer=L.geoJSON(areaA,{
  style:{color:"#006400",weight:2,fillColor:"#00ff00",fillOpacity:0.35},
  onEachFeature:(f,l)=>l.bindPopup("<b>Area A</b><br>Allowed")
}).addTo(map);

var areaBLayer=L.geoJSON(areaB,{
  style:{color:"#b8860b",weight:2,fillColor:"#ffff00",fillOpacity:0.35},
  onEachFeature:(f,l)=>l.bindPopup("<b>Area B</b><br>Restricted")
}).addTo(map);

var areaCLayer=L.geoJSON(areaC,{
  style:{color:"#8b0000",weight:2,fillColor:"#ff0000",fillOpacity:0.35},
  onEachFeature:(f,l)=>l.bindPopup("<b>Area C</b><br>Not Allowed")
}).addTo(map);

/* BASE */
var builtLayer=L.geoJSON(built,{style:{color:"#8B4513",fillOpacity:0.7},onEachFeature:popupAttributes}).addTo(map);
var roadsLayer=L.geoJSON(roads,{style:{color:"#4B0082"},onEachFeature:popupAttributes}).addTo(map);

/* POINTS */
var schoolsLayer=L.geoJSON(schools,{pointToLayer:(f,ll)=>L.marker(ll,{icon:icon("ðŸŽ“","icon-school")}),onEachFeature:popupAttributes}).addTo(map);
var hospitalsLayer=L.geoJSON(hospitals,{pointToLayer:(f,ll)=>L.marker(ll,{icon:icon("âœš","icon-hospital")}),onEachFeature:popupAttributes}).addTo(map);
var clinicsLayer=L.geoJSON(clinics,{pointToLayer:(f,ll)=>L.marker(ll,{icon:icon("âœš","icon-clinic")}),onEachFeature:popupAttributes}).addTo(map);
var wellsLayer=L.geoJSON(wells,{pointToLayer:(f,ll)=>L.marker(ll,{icon:icon("ðŸ’§","icon-well")}),onEachFeature:popupAttributes}).addTo(map);
var quarriesLayer=L.geoJSON(quarries,{pointToLayer:(f,ll)=>L.marker(ll,{icon:icon("â›","icon-quarry")}),onEachFeature:popupAttributes}).addTo(map);
var outpostsLayer=L.geoJSON(outposts,{pointToLayer:(f,ll)=>L.marker(ll,{icon:icon("â›º","icon-outpost")}),onEachFeature:popupAttributes}).addTo(map);

/* POLYGONS */
var settlementsLayer=L.geoJSON(settlements,{style:{color:"#ff0000"},onEachFeature:popupAttributes}).addTo(map);
var militaryLayer=L.geoJSON(military,{style:{color:"#800000"},onEachFeature:popupAttributes}).addTo(map);
var naturalLayer=L.geoJSON(natural,{style:{color:"#228b22",fillOpacity:0.5},onEachFeature:popupAttributes}).addTo(map);

/* SUGGESTED SCHOOL LOCATIONS */
var suggestedSites={
"type":"FeatureCollection",
"features":[
{"type":"Feature","properties":{"Site_ID":1,"Land_Class":"A","Nearby_Schools":2,"Required_Schools":1,"Decision":"Highly Suitable"},
"geometry":{"type":"Point","coordinates":[35.205,31.91]}},
{"type":"Feature","properties":{"Site_ID":2,"Land_Class":"B","Nearby_Schools":1,"Required_Schools":2,"Decision":"Moderately Suitable"},
"geometry":{"type":"Point","coordinates":[35.215,31.895]}}
]};

var suggestedLayer=L.geoJSON(suggestedSites,{
  pointToLayer:(f,ll)=>L.marker(ll,{icon:icon("ðŸ«","icon-suggested")}),
  onEachFeature:(f,l)=>l.bindPopup(`
    <b>Proposed School</b><br>
    Land Class: ${f.properties.Land_Class}<br>
    Nearby Schools: ${f.properties.Nearby_Schools}<br>
    Required Schools: ${f.properties.Required_Schools}<br>
    Decision: <b>${f.properties.Decision}</b>
  `)
}).addTo(map);

/* ORDER */
areaALayer.bringToBack();
areaBLayer.bringToBack();
areaCLayer.bringToBack();
ramallahLayer.bringToFront();

/* LAYER CONTROL */
L.control.layers(null,{
  "Ramallah Boundary":ramallahLayer,
  "Area A":areaALayer,
  "Area B":areaBLayer,
  "Area C":areaCLayer,
  "Built-up":builtLayer,
  "Roads":roadsLayer,
  "Schools":schoolsLayer,
  "Hospitals":hospitalsLayer,
  "Clinics":clinicsLayer,
  "Wells":wellsLayer,
  "Quarries":quarriesLayer,
  "Outposts":outpostsLayer,
  "Settlements":settlementsLayer,
  "Military Sites":militaryLayer,
  "Natural Areas":naturalLayer,
  "Proposed School Sites":suggestedLayer
},{collapsed:false}).addTo(map);
}
</script>
</body>
</html>
