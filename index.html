<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Future Schools Site Suitability - Ramallah</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

    <style>
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100vh;
            width: 100%;
        }
        .legend {
            padding: 10px;
            background: white;
            line-height: 18px;
            border-radius: 6px;
            box-shadow: 0 0 6px #999;
        }
    </style>
</head>

<body>
    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // ======================
        // 1) Initialize the Map
        // ======================
        var map = L.map('map').setView([31.9, 35.2], 13);

        // Base Map Layer
        var basemap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // ======================
        // 2) Load Layer Function
        // ======================
        function loadGeoJSON(file, style = {}, popupField = null) {
            return fetch(file)
                .then(res => res.json())
                .then(data => {
                    return L.geoJSON(data, {
                        style: style,
                        onEachFeature: function (feature, layer) {
                            if (popupField && feature.properties[popupField]) {
                                layer.bindPopup(String(feature.properties[popupField]));
                            }
                        }
                    });
                });
        }

        // ======================
        // 3) Load All Layers
        // ======================

        Promise.all([
            loadGeoJSON("ramallah.json", { color: "#222", weight: 2 }, null),
            loadGeoJSON("built_up.json", { color: "#ff7800", weight: 1, fillOpacity: 0.5 }),
            loadGeoJSON("roods.json", { color: "#0066ff", weight: 2 }),
            loadGeoJSON("schools.json", {}, "name"),
            loadGeoJSON("slope.json", { color: "#228B22", weight: 1 }),
            loadGeoJSON("wells.json", { color: "blue" }, "type"),
            loadGeoJSON("natural.json", { color: "#008000", weight: 1, fillOpacity: 0.4 })
        ]).then(function (layers) {

            var ramallah = layers[0].addTo(map);
            var built_up = layers[1].addTo(map);
            var roads = layers[2].addTo(map);
            var schools = layers[3].addTo(map);
            var slope = layers[4].addTo(map);
            var wells = layers[5].addTo(map);
            var natural = layers[6].addTo(map);

            // ======================
            // 4) Layer Control
            // ======================
            var overlays = {
                "Ramallah Boundary": ramallah,
                "Built-up Areas": built_up,
                "Road Network": roads,
                "Schools": schools,
                "Slope": slope,
                "Wells": wells,
                "Natural Areas": natural
            };

            L.control.layers(null, overlays).addTo(map);

            // ==============================
            // 5) Simple Suitability Analysis
            // ==============================

            // Example: highlight areas suitable for a new school
            // (Only for demonstration â€” can be improved later)

            var suitabilityStyle = {
                color: "green",
                fillColor: "lightgreen",
                weight: 1,
                fillOpacity: 0.4
            };

            var suitabilityLayer = L.geoJSON(null, suitabilityStyle);

            // Simple example: show built-up area as "potential"
            built_up.eachLayer(function (layer) {
                suitabilityLayer.addData(layer.toGeoJSON());
            });

            suitabilityLayer.addTo(map);

            L.control.layers(null, {
                "Suitable Areas (Demo)": suitabilityLayer
            }, { collapsed: false }).addTo(map);

        });

    </script>

</body>
</html>
