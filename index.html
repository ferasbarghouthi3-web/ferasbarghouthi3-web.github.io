<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Future Schools Site Suitability - Ramallah</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

    <style>
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100vh;
            width: 100%;
        }
        .legend {
            padding: 10px;
            background: white;
            line-height: 18px;
            border-radius: 6px;
            box-shadow: 0 0 6px #999;
        }
    </style>
</head>

<body>
    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // ======================
        // 1) Initialize the Map
        // ======================
        var map = L.map('map').setView([31.9, 35.2], 13);

        // Base Map Layer
        var basemap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // ======================
        // 2) Function: Load GeoJSON
        // With full popup attributes table
        // ======================
        function loadGeoJSON(file, style = {}) {
            return fetch(file)
                .then(res => res.json())
                .then(data => {
                    return L.geoJSON(data, {
                        style: style,
                        onEachFeature: function (feature, layer) {

                            // Create HTML table with attributes
                            let info = "<b>Attributes:</b><br><table style='width:100%; border-collapse: collapse;'>";

                            for (let key in feature.properties) {
                                info += `
                                    <tr>
                                        <td style="border:1px solid #ccc; padding:4px;"><b>${key}</b></td>
                                        <td style="border:1px solid #ccc; padding:4px;">${feature.properties[key]}</td>
                                    </tr>
                                `;
                            }

                            info += "</table>";

                            // Bind popup
                            layer.bindPopup(info);

                            // Optionally log attributes in console
                            layer.on("click", function () {
                                console.log("Feature Properties:", feature.properties);
                            });
                        }
                    });
                });
        }

        // ======================
        // 3) Load All Layers
        // ======================
        Promise.all([
            loadGeoJSON("ramallah.json", { color: "#222", weight: 2 }),
            loadGeoJSON("built_up.json", { color: "#ff7800", weight: 1, fillOpacity: 0.5 }),
            loadGeoJSON("roods.json", { color: "#0066ff", weight: 2 }),
            loadGeoJSON("schools.json", { color: "red" }),
            loadGeoJSON("slope.json", { color: "#228B22", weight: 1 }),
            loadGeoJSON("wells.json", { color: "blue" }),
            loadGeoJSON("natural.json", { color: "#008000", weight: 1, fillOpacity: 0.4 })
        ]).then(function (layers) {

            var ramallah = layers[0].addTo(map);
            var built_up = layers[1].addTo(map);
            var roads = layers[2].addTo(map);
            var schools = layers[3].addTo(map);
            var slope = layers[4].addTo(map);
            var wells = layers[5].addTo(map);
            var natural = layers[6].addTo(map);

            // Layer Control
            var overlays = {
                "Ramallah Boundary": ramallah,
                "Built-up Areas": built_up,
                "Road Network": roads,
                "Schools": schools,
                "Slope": slope,
                "Wells": wells,
                "Natural Areas": natural
            };
            L.control.layers(null, overlays).addTo(map);

            // ==============================
            // 4) Simple Suitability Layer (demo)
            // ==============================
            var suitabilityStyle = {
                color: "green",
                fillColor: "lightgreen",
                weight: 1,
                fillOpacity: 0.4
            };

            var suitabilityLayer = L.geoJSON(null, suitabilityStyle);

            // Add built-up areas as a mock "suitable" zone
            built_up.eachLayer(function (layer) {
                suitabilityLayer.addData(layer.toGeoJSON());
            });

            suitabilityLayer.addTo(map);

            L.control.layers(null, {
                "Suitable Areas (Demo)": suitabilityLayer
            }, { collapsed: false }).addTo(map);
        });

    </script>

</body>
</html>
